const window = @import("window.zig");

const Character = [char_height]@Type(.{ .int = .{ .signedness = .unsigned, .bits = char_width } });

const char_width = 7;
const char_height = 10;

const gap_width = 9;
const gap_height = 6;

const cell_width = char_width + gap_width;
const cell_height = char_height + gap_height;

comptime {
    if (cell_width != cell_height) unreachable;
    if (cell_width != window.cell_size) unreachable;
}

const replacement = .{(1 << char_width) - 1} ** char_height;

const table: [0x80]Character = table: {
    var result = characters;
    @setEvalBranchQuota(result.len * 11);
    // Reverse the rows of bits of all characters now to avoid doing it at runtime instead.
    for (result, 0..) |character, index| {
        for (0..char_height) |y| {
            result[index][y] = @bitReverse(character[y]);
        }
    }
    break :table result;
};

pub fn draw_character(character: u8, x: u16, y: u16, color: window.Color) void {
    var relative_y: u16 = 0;
    while (relative_y != char_height) : (relative_y += 1) {
        window.draw_bits(char_width, table[character][relative_y], x, y + relative_y, color);
    }
}

const miscellaneous1 = [_]Character{
    .{ // Space
        0b00000,
        0b00000,
        0b00000,
        0b00000,
        0b00000,
        0b00000,
        0b00000,
        0b00000,
        0b00000,
        0b00000,
    },
    .{ // Exclamation mark
        0b00100,
        0b00100,
        0b00100,
        0b00100,
        0b00100,
        0b00100,
        0b00000,
        0b00100,
        0b00100,
        0b00000,
    },
    .{ // Double quote
        0b01010,
        0b01010,
        0b00000,
        0b00000,
        0b00000,
        0b00000,
        0b00000,
        0b00000,
        0b00000,
        0b00000,
    },
    .{ // Number sign
        0b01010,
        0b01010,
        0b11111,
        0b01010,
        0b01010,
        0b01010,
        0b11111,
        0b01010,
        0b01010,
        0b00000,
    },
    .{ // Dollar sign
        0b00100,
        0b01110,
        0b10101,
        0b10100,
        0b01110,
        0b00101,
        0b10101,
        0b01110,
        0b00100,
        0b00000,
    },
    .{ // Percent sign
        0b11001,
        0b11001,
        0b00010,
        0b00010,
        0b00100,
        0b01000,
        0b01000,
        0b10011,
        0b10011,
        0b00000,
    },
    .{ // Ampersand
        0b00100,
        0b01010,
        0b01010,
        0b00100,
        0b01101,
        0b10110,
        0b10010,
        0b10010,
        0b01101,
        0b00000,
    },
    .{ // Apostrophe
        0b00100,
        0b00100,
        0b00000,
        0b00000,
        0b00000,
        0b00000,
        0b00000,
        0b00000,
        0b00000,
        0b00000,
    },
    .{ // Left parenthesis
        0b00010,
        0b00100,
        0b00100,
        0b01000,
        0b01000,
        0b01000,
        0b00100,
        0b00100,
        0b00010,
        0b00000,
    },
    .{ // Right parenthesis
        0b01000,
        0b00100,
        0b00100,
        0b00010,
        0b00010,
        0b00010,
        0b00100,
        0b00100,
        0b01000,
        0b00000,
    },
    .{ // Asterisk
        0b00100,
        0b11111,
        0b00100,
        0b01010,
        0b00000,
        0b00000,
        0b00000,
        0b00000,
        0b00000,
        0b00000,
    },
    .{ // Plus sign
        0b00000,
        0b00000,
        0b00100,
        0b00100,
        0b11111,
        0b00100,
        0b00100,
        0b00000,
        0b00000,
        0b00000,
    },
    .{ // Comma
        0b00000,
        0b00000,
        0b00000,
        0b00000,
        0b00000,
        0b00000,
        0b00000,
        0b00000,
        0b00100,
        0b00100,
    },
    .{ // Hyphen-minus
        0b00000,
        0b00000,
        0b00000,
        0b00000,
        0b11111,
        0b00000,
        0b00000,
        0b00000,
        0b00000,
        0b00000,
    },
    .{ // Period
        0b00000,
        0b00000,
        0b00000,
        0b00000,
        0b00000,
        0b00000,
        0b00000,
        0b00000,
        0b00100,
        0b00000,
    },
    .{ // Slash
        0b00001,
        0b00010,
        0b00010,
        0b00100,
        0b00100,
        0b00100,
        0b01000,
        0b01000,
        0b10000,
        0b00000,
    },
};

/// The Arabic numerals.
const digits = [10]Character{
    .{ // 0
        0b01110,
        0b10001,
        0b10001,
        0b10001,
        0b10101,
        0b10001,
        0b10001,
        0b10001,
        0b01110,
        0b00000,
    },
    .{ // 1
        0b00100,
        0b01100,
        0b10100,
        0b00100,
        0b00100,
        0b00100,
        0b00100,
        0b00100,
        0b01110,
        0b00000,
    },
    .{ // 2
        0b01110,
        0b10001,
        0b10001,
        0b00001,
        0b00010,
        0b00100,
        0b01000,
        0b10000,
        0b11111,
        0b00000,
    },
    .{ // 3
        0b01110,
        0b10001,
        0b00001,
        0b00001,
        0b01110,
        0b00001,
        0b00001,
        0b10001,
        0b01110,
        0b00000,
    },
    .{ // 4
        0b00011,
        0b00101,
        0b01001,
        0b10001,
        0b11111,
        0b00001,
        0b00001,
        0b00001,
        0b00001,
        0b00000,
    },
    .{ // 5
        0b11111,
        0b10000,
        0b10000,
        0b10000,
        0b11110,
        0b00001,
        0b00001,
        0b10001,
        0b01110,
        0b00000,
    },
    .{ // 6
        0b01110,
        0b10001,
        0b10000,
        0b10000,
        0b11110,
        0b10001,
        0b10001,
        0b10001,
        0b01110,
        0b00000,
    },
    .{ // 7
        0b11111,
        0b00001,
        0b00001,
        0b00010,
        0b00010,
        0b00100,
        0b00100,
        0b01000,
        0b01000,
        0b00000,
    },
    .{ // 8
        0b01110,
        0b10001,
        0b10001,
        0b10001,
        0b01110,
        0b10001,
        0b10001,
        0b10001,
        0b01110,
        0b00000,
    },
    .{ // 9
        0b01110,
        0b10001,
        0b10001,
        0b10001,
        0b01111,
        0b00001,
        0b00001,
        0b10001,
        0b01110,
        0b00000,
    },
};

const miscellaneous2 = [_]Character{
    .{ // Colon
        0b00000,
        0b00000,
        0b00100,
        0b00100,
        0b00000,
        0b00100,
        0b00100,
        0b00000,
        0b00000,
        0b00000,
    },
    .{ // Semicolon
        0b00000,
        0b00000,
        0b00100,
        0b00100,
        0b00000,
        0b00100,
        0b00100,
        0b01000,
        0b00000,
        0b00000,
    },
    .{ // Less-than sign
        0b00001,
        0b00010,
        0b00100,
        0b01000,
        0b10000,
        0b01000,
        0b00100,
        0b00010,
        0b00001,
        0b00000,
    },
    .{ // Equal sign
        0b00000,
        0b00000,
        0b00000,
        0b11111,
        0b00000,
        0b11111,
        0b00000,
        0b00000,
        0b00000,
        0b00000,
    },
    .{ // Greater-than sign
        0b10000,
        0b01000,
        0b00100,
        0b00010,
        0b00001,
        0b00010,
        0b00100,
        0b01000,
        0b10000,
        0b00000,
    },
    .{ // Question mark
        0b01110,
        0b10001,
        0b10001,
        0b00001,
        0b00010,
        0b00100,
        0b00100,
        0b00000,
        0b00100,
        0b00000,
    },
    .{ // At sign
        0b00110,
        0b01001,
        0b10011,
        0b10101,
        0b10101,
        0b10101,
        0b10010,
        0b01000,
        0b00110,
        0b00000,
    },
};

/// The uppercase Latin alphabet.
const uppercase_letters = [26]Character{
    .{ // A
        0b01110,
        0b10001,
        0b10001,
        0b10001,
        0b11111,
        0b10001,
        0b10001,
        0b10001,
        0b10001,
        0b00000,
    },
    .{ // B
        0b11110,
        0b10001,
        0b10001,
        0b10001,
        0b11110,
        0b10001,
        0b10001,
        0b10001,
        0b11110,
        0b00000,
    },
    .{ // C
        0b00110,
        0b01001,
        0b10000,
        0b10000,
        0b10000,
        0b10000,
        0b10000,
        0b01001,
        0b00110,
        0b00000,
    },
    .{ // D
        0b11100,
        0b10010,
        0b10001,
        0b10001,
        0b10001,
        0b10001,
        0b10001,
        0b10010,
        0b11100,
        0b00000,
    },
    .{ // E
        0b11111,
        0b10000,
        0b10000,
        0b10000,
        0b11111,
        0b10000,
        0b10000,
        0b10000,
        0b11111,
        0b00000,
    },
    .{ // F
        0b11111,
        0b10000,
        0b10000,
        0b10000,
        0b11111,
        0b10000,
        0b10000,
        0b10000,
        0b10000,
        0b00000,
    },
    .{ // G
        0b01110,
        0b10001,
        0b10001,
        0b10000,
        0b10111,
        0b10001,
        0b10001,
        0b10001,
        0b01110,
        0b00000,
    },
    .{ // H
        0b10001,
        0b10001,
        0b10001,
        0b10001,
        0b11111,
        0b10001,
        0b10001,
        0b10001,
        0b10001,
        0b00000,
    },
    .{ // I
        0b01110,
        0b00100,
        0b00100,
        0b00100,
        0b00100,
        0b00100,
        0b00100,
        0b00100,
        0b01110,
        0b00000,
    },
    .{ // J
        0b00111,
        0b00010,
        0b00010,
        0b00010,
        0b00010,
        0b00010,
        0b00010,
        0b10010,
        0b01100,
        0b00000,
    },
    .{ // K
        0b10001,
        0b10001,
        0b10010,
        0b10100,
        0b11000,
        0b10100,
        0b10010,
        0b10001,
        0b10001,
        0b00000,
    },
    .{ // L
        0b10000,
        0b10000,
        0b10000,
        0b10000,
        0b10000,
        0b10000,
        0b10000,
        0b10000,
        0b11111,
        0b00000,
    },
    .{ // M
        0b10001,
        0b10001,
        0b11011,
        0b11011,
        0b10101,
        0b10101,
        0b10001,
        0b10001,
        0b10001,
        0b00000,
    },
    .{ // N
        0b10001,
        0b10001,
        0b11001,
        0b11001,
        0b10101,
        0b10011,
        0b10011,
        0b10001,
        0b10001,
        0b00000,
    },
    .{ // O
        0b01110,
        0b10001,
        0b10001,
        0b10001,
        0b10001,
        0b10001,
        0b10001,
        0b10001,
        0b01110,
        0b00000,
    },
    .{ // P
        0b11110,
        0b10001,
        0b10001,
        0b10001,
        0b11110,
        0b10000,
        0b10000,
        0b10000,
        0b10000,
        0b00000,
    },
    .{ // Q
        0b01110,
        0b10001,
        0b10001,
        0b10001,
        0b10001,
        0b10001,
        0b10101,
        0b10010,
        0b01101,
        0b00000,
    },
    .{ // R
        0b11110,
        0b10001,
        0b10001,
        0b10001,
        0b11110,
        0b10001,
        0b10001,
        0b10001,
        0b10001,
        0b00000,
    },
    .{ // S
        0b01110,
        0b10001,
        0b10000,
        0b10000,
        0b01110,
        0b00001,
        0b00001,
        0b10001,
        0b01110,
        0b00000,
    },
    .{ // T
        0b11111,
        0b00100,
        0b00100,
        0b00100,
        0b00100,
        0b00100,
        0b00100,
        0b00100,
        0b00100,
        0b00000,
    },
    .{ // U
        0b10001,
        0b10001,
        0b10001,
        0b10001,
        0b10001,
        0b10001,
        0b10001,
        0b10001,
        0b01110,
        0b00000,
    },
    .{ // V
        0b10001,
        0b10001,
        0b10001,
        0b10001,
        0b01010,
        0b01010,
        0b01010,
        0b00100,
        0b00100,
        0b00000,
    },
    .{ // W
        0b10001,
        0b10001,
        0b10001,
        0b10101,
        0b10101,
        0b11011,
        0b11011,
        0b10001,
        0b10001,
        0b00000,
    },
    .{ // X
        0b10001,
        0b10001,
        0b01010,
        0b01010,
        0b00100,
        0b01010,
        0b01010,
        0b10001,
        0b10001,
        0b00000,
    },
    .{ // Y
        0b10001,
        0b10001,
        0b10001,
        0b01010,
        0b01010,
        0b00100,
        0b00100,
        0b00100,
        0b00100,
        0b00000,
    },
    .{ // Z
        0b11111,
        0b00001,
        0b00010,
        0b00010,
        0b00100,
        0b01000,
        0b01000,
        0b10000,
        0b11111,
        0b00000,
    },
};

const miscellaneous3 = [_]Character{
    .{ // Left bracket
        0b01110,
        0b01000,
        0b01000,
        0b01000,
        0b01000,
        0b01000,
        0b01000,
        0b01000,
        0b01110,
        0b00000,
    },
    .{ // Backslash
        0b10000,
        0b01000,
        0b01000,
        0b00100,
        0b00100,
        0b00100,
        0b00010,
        0b00010,
        0b00001,
        0b00000,
    },
    .{ // Right bracket
        0b01110,
        0b00010,
        0b00010,
        0b00010,
        0b00010,
        0b00010,
        0b00010,
        0b00010,
        0b01110,
        0b00000,
    },
    .{ // Caret
        0b00100,
        0b01010,
        0b10001,
        0b00000,
        0b00000,
        0b00000,
        0b00000,
        0b00000,
        0b00000,
        0b00000,
    },
    .{ // Underscore
        0b00000,
        0b00000,
        0b00000,
        0b00000,
        0b00000,
        0b00000,
        0b00000,
        0b00000,
        0b11111,
        0b00000,
    },
    .{ // Backtick
        0b10000,
        0b01000,
        0b00100,
        0b00000,
        0b00000,
        0b00000,
        0b00000,
        0b00000,
        0b00000,
        0b00000,
    },
};

const lowercase_letters = [26]Character{
    .{ // a
        0b00000,
        0b00000,
        0b00000,
        0b01110,
        0b00001,
        0b01111,
        0b10001,
        0b10001,
        0b01111,
        0b00000,
    },
    .{ // b
        0b10000,
        0b10000,
        0b10000,
        0b11110,
        0b10001,
        0b10001,
        0b10001,
        0b10001,
        0b11110,
        0b00000,
    },
    .{ // c
        0b00000,
        0b00000,
        0b00000,
        0b01110,
        0b10001,
        0b10000,
        0b10000,
        0b10001,
        0b01110,
        0b00000,
    },
    .{ // d
        0b00001,
        0b00001,
        0b00001,
        0b01111,
        0b10001,
        0b10001,
        0b10001,
        0b10001,
        0b01111,
        0b00000,
    },
    .{ // e
        0b00000,
        0b00000,
        0b00000,
        0b01110,
        0b10001,
        0b11111,
        0b10000,
        0b10001,
        0b01110,
        0b00000,
    },
    .{ // f
        0b00010,
        0b00100,
        0b00100,
        0b01110,
        0b00100,
        0b00100,
        0b00100,
        0b00100,
        0b00100,
        0b00000,
    },
    .{ // g
        0b00000,
        0b00000,
        0b00000,
        0b01111,
        0b10001,
        0b10001,
        0b01111,
        0b00001,
        0b10001,
        0b01110,
    },
    .{ // h
        0b10000,
        0b10000,
        0b10000,
        0b11110,
        0b10001,
        0b10001,
        0b10001,
        0b10001,
        0b10001,
        0b00000,
    },
    .{ // i
        0b00100,
        0b00100,
        0b00000,
        0b00100,
        0b00100,
        0b00100,
        0b00100,
        0b00100,
        0b00100,
        0b00000,
    },
    .{ // j
        0b00010,
        0b00010,
        0b00000,
        0b00010,
        0b00010,
        0b00010,
        0b00010,
        0b00010,
        0b01010,
        0b00100,
    },
    .{ // k
        0b10000,
        0b10000,
        0b10000,
        0b10010,
        0b10100,
        0b11000,
        0b10100,
        0b10010,
        0b10001,
        0b00000,
    },
    .{ // l
        0b01100,
        0b00100,
        0b00100,
        0b00100,
        0b00100,
        0b00100,
        0b00100,
        0b00100,
        0b00010,
        0b00000,
    },
    .{ // m
        0b00000,
        0b00000,
        0b00000,
        0b11110,
        0b10101,
        0b10101,
        0b10101,
        0b10101,
        0b10101,
        0b00000,
    },
    .{ // n
        0b00000,
        0b00000,
        0b00000,
        0b11110,
        0b10001,
        0b10001,
        0b10001,
        0b10001,
        0b10001,
        0b00000,
    },
    .{ // o
        0b00000,
        0b00000,
        0b00000,
        0b01110,
        0b10001,
        0b10001,
        0b10001,
        0b10001,
        0b01110,
        0b00000,
    },
    .{ // p
        0b00000,
        0b00000,
        0b00000,
        0b01110,
        0b10001,
        0b10001,
        0b10001,
        0b11110,
        0b10000,
        0b10000,
    },
    .{ // q
        0b00000,
        0b00000,
        0b00000,
        0b01110,
        0b10001,
        0b10001,
        0b10001,
        0b01111,
        0b00001,
        0b00001,
    },
    .{ // r
        0b00000,
        0b00000,
        0b00000,
        0b01010,
        0b01100,
        0b01000,
        0b01000,
        0b01000,
        0b01000,
        0b00000,
    },
    .{ // s
        0b00000,
        0b00000,
        0b00000,
        0b01111,
        0b10000,
        0b01110,
        0b00001,
        0b00001,
        0b11110,
        0b00000,
    },
    .{ // t
        0b00100,
        0b00100,
        0b00100,
        0b01110,
        0b00100,
        0b00100,
        0b00100,
        0b00100,
        0b00010,
        0b00000,
    },
    .{ // u
        0b00000,
        0b00000,
        0b00000,
        0b10001,
        0b10001,
        0b10001,
        0b10001,
        0b10001,
        0b01111,
        0b00000,
    },
    .{ // v
        0b00000,
        0b00000,
        0b00000,
        0b10001,
        0b10001,
        0b01010,
        0b01010,
        0b00100,
        0b00100,
        0b00000,
    },
    .{ // w
        0b00000,
        0b00000,
        0b00000,
        0b10101,
        0b10101,
        0b10101,
        0b10101,
        0b10101,
        0b01010,
        0b00000,
    },
    .{ // x
        0b00000,
        0b00000,
        0b00000,
        0b10001,
        0b01010,
        0b00100,
        0b00100,
        0b01010,
        0b10001,
        0b00000,
    },
    .{ // y
        0b00000,
        0b00000,
        0b00000,
        0b10001,
        0b10001,
        0b01010,
        0b01010,
        0b00100,
        0b00100,
        0b11000,
    },
    .{ // z
        0b00000,
        0b00000,
        0b00000,
        0b11111,
        0b00001,
        0b00010,
        0b00100,
        0b01000,
        0b11111,
        0b00000,
    },
};

const miscellaneous4 = [_]Character{
    .{ // Left brace
        0b00010,
        0b00100,
        0b00100,
        0b00100,
        0b01000,
        0b00100,
        0b00100,
        0b00100,
        0b00010,
        0b00000,
    },
    .{ // Vertical bar
        0b00100,
        0b00100,
        0b00100,
        0b00100,
        0b00100,
        0b00100,
        0b00100,
        0b00100,
        0b00100,
        0b00000,
    },
    .{ // Right brace
        0b01000,
        0b00100,
        0b00100,
        0b00100,
        0b00010,
        0b00100,
        0b00100,
        0b00100,
        0b01000,
        0b00000,
    },
    .{ // Tilde
        0b00000,
        0b00000,
        0b00000,
        0b00000,
        0b01101,
        0b10110,
        0b00000,
        0b00000,
        0b00000,
        0b00000,
    },
};

const characters: [0x80]Character =
    [1]Character{replacement} ** 32 ++ // Control characters.
    // Start of printable characters.
    miscellaneous1 ++
    digits ++
    miscellaneous2 ++
    uppercase_letters ++
    miscellaneous3 ++
    lowercase_letters ++
    miscellaneous4 ++
    // End of printable characters.
    [1]Character{replacement}; // Another control character.
